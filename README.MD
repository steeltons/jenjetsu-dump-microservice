<h2 align="center">Nexign simple system</h2>

<h3 align="center">Порядок запуска:</h3>
<ol>
    <li>Загрузка SQL команд из файла database.sql</li>
    <li>Запуск модуля CRM - Eureka сервер и балансировка</li>
    <li>Запуск HRS или CDR2</li>
    <li>Через 20 - 30 секунд запуск BRT</li>
</ol>
<h3>Принцип работы</h3>
<p>BRT из static main метода посылает запрос на CDR</p>
<p>CDR генерирует звонки и возвращает их в систему</p>
<p>CDR группирует звонки по номерам и затем отпрвляет каждый звонок в HRS</p>
<p>HRS обрабатывает, генерирует счёт для абонента и отправляет в BRT</p>
<p>BRT подсчитывает итоговую сумму для абонента, проверяет его баланс, и если он отрицательный, 
то удаляет пользователя из бд, иначе меняет баланс</p>

<h3 align="center">Процесс аутентификации</h3>
<p>CRM работает на порту localhost:8761</p>
<p>Для того, чтобы работать с BRT, нужен токен. Токен можно получить в CRM при помощи двух запросов:</p>
<ol>
    <li>POST /api/v1/auth/manager</li>  
    <li>POST /api/v1/auth/abonent</li>
</ol>
<p>Тело запроса одинаковое : </p>
<p>{</p>
<p>     "username" : "admin"</p>
<p>     "password" : "123321"</p>
<p>}</p>
<p>Для роли менеджера использовать логин admin и пароль 123321</p>
<p>Для абонентов в качестве логина используется их номер телефона, а пароль состоит из первых 5-и цифр номера телефона</p>

<h3 align="center">BRT</h3>
<p>BRT работает на порту localhost:8080</p>
<p>Токен нужно прикреплять при каждом запросе к BRT</p>
<p>Для деавторизации нужно отправить на адресс POST /api/v1/logout запрос с телом</p>
<p>{ "refreshToken" : ${refreshToken} }</p>
<p>Для токенов используется один и тот же секретный ключ = 12345</p>

<ol>
    <li>PATCH /api/v1/abonent/pay - пополнение баланса абонента, может либо менеджер, либо тот же самый абонент</li>
    <li>GET /api/v1/abonent/report/{number} - просмотр списка звонов абонента. Может смотреть либо менеджер, либо тот же самый абонент</li>
    <li>PATCH /api/v1/manager/changeTariff - смена тарифа абонента. Может делать только менеджер</li>
    <li>POST /api/v1/manager/generate - добавление абонента в БД. Может делать только менеджер</li>
    <li>PATCH /api/v1/manager/billig - процесс биллинга для абонентов. Может делать только менеджер.</li>
    <li>PATCH /api/v1/manager/generate-abonents - создание абонентов на стороне CDR и добавление их в систему</li>
</ol>




